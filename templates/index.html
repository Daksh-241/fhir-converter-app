<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHIR Data Converter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            margin-bottom: 2rem;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, #5a6fd8, #6a4190);
        }
        .feature-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 1rem;
        }
        .status-success {
            color: #28a745;
        }
        .status-error {
            color: #dc3545;
        }
        .mobile-optimized {
            padding: 1rem;
        }
        @media (max-width: 768px) {
            .hero-section {
                padding: 2rem 0;
            }
            .mobile-optimized {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-hospital"></i> FHIR Converter
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#upload">Upload</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#patient">Patient</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#api">API</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 mb-4">FHIR Data Converter</h1>
            <p class="lead mb-4">Convert Excel files and patient data to FHIR format with ease</p>
            <div class="row">
                <div class="col-md-4">
                    <i class="fas fa-file-excel feature-icon"></i>
                    <h4>Excel Upload</h4>
                    <p>Upload Excel files and convert to FHIR</p>
                </div>
                <div class="col-md-4">
                    <i class="fas fa-user-plus feature-icon"></i>
                    <h4>Patient Entry</h4>
                    <p>Enter patient data manually</p>
                </div>
                <div class="col-md-4">
                    <i class="fas fa-mobile-alt feature-icon"></i>
                    <h4>Multi-Device</h4>
                    <p>Works on all devices</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container mobile-optimized">
        <!-- File Upload Section -->
        <section id="upload" class="my-5">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-upload"></i> Upload Excel File</h3>
                </div>
                <div class="card-body">
                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="fileInput" class="form-label">Select Excel File</label>
                            <input type="file" class="form-control" id="fileInput" accept=".xlsx,.xls,.csv" required>
                            <div class="form-text">Supported formats: .xlsx, .xls, .csv (Max 16MB)</div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Upload & Convert
                        </button>
                    </form>
                    <div id="uploadStatus" class="mt-3"></div>
                </div>
            </div>
        </section>

        <!-- Patient Entry Section -->
        <section id="patient" class="my-5">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-user-plus"></i> Enter Patient Data</h3>
                </div>
                <div class="card-body">
                    <form id="patientForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="firstName" class="form-label">First Name *</label>
                                    <input type="text" class="form-control" id="firstName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="lastName" class="form-label">Last Name *</label>
                                    <input type="text" class="form-control" id="lastName" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="gender" class="form-label">Gender</label>
                                    <select class="form-select" id="gender">
                                        <option value="unknown">Unknown</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="birthDate" class="form-label">Birth Date</label>
                                    <input type="date" class="form-control" id="birthDate">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="phone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Address</label>
                            <input type="text" class="form-control" id="address">
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="state" class="form-label">State</label>
                                    <input type="text" class="form-control" id="state">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="postalCode" class="form-label">Postal Code</label>
                                    <input type="text" class="form-control" id="postalCode">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="condition" class="form-label">Medical Condition</label>
                            <input type="text" class="form-control" id="condition">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Create Patient
                        </button>
                    </form>
                    <div id="patientStatus" class="mt-3"></div>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results" class="my-5" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-download"></i> Download Results</h3>
                </div>
                <div class="card-body">
                    <div id="resultInfo"></div>
                    <div class="mt-3">
                        <button id="downloadJson" class="btn btn-success me-2">
                            <i class="fas fa-download"></i> Download JSON
                        </button>
                        <button id="downloadCsv" class="btn btn-info">
                            <i class="fas fa-file-csv"></i> Download CSV
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- API Documentation -->
        <section id="api" class="my-5">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-code"></i> API Endpoints</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>File Upload</h5>
                            <code>POST /api/upload</code>
                            <p>Upload Excel file and convert to FHIR</p>
                        </div>
                        <div class="col-md-6">
                            <h5>Patient Creation</h5>
                            <code>POST /api/patient</code>
                            <p>Create FHIR patient from form data</p>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h5>Get Bundle</h5>
                            <code>GET /api/bundle/{id}</code>
                            <p>Retrieve FHIR bundle by ID</p>
                        </div>
                        <div class="col-md-6">
                            <h5>Health Check</h5>
                            <code>GET /api/health</code>
                            <p>Check API status</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p>&copy; 2024 FHIR Data Converter. Built for healthcare interoperability.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // File upload handling
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            const fileInput = document.getElementById('fileInput');
            const statusDiv = document.getElementById('uploadStatus');
            
            if (!fileInput.files[0]) {
                statusDiv.innerHTML = '<div class="alert alert-warning">Please select a file</div>';
                return;
            }
            
            formData.append('file', fileInput.files[0]);
            
            try {
                statusDiv.innerHTML = '<div class="alert alert-info">Uploading and processing...</div>';
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = `<div class="alert alert-success">${result.message}</div>`;
                    showResults(result.bundle_id, result.resource_count);
                } else {
                    statusDiv.innerHTML = `<div class="alert alert-danger">Error: ${result.error}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });

        // Patient form handling
        document.getElementById('patientForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                gender: document.getElementById('gender').value,
                birthDate: document.getElementById('birthDate').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                postalCode: document.getElementById('postalCode').value,
                condition: document.getElementById('condition').value
            };
            
            const statusDiv = document.getElementById('patientStatus');
            
            try {
                statusDiv.innerHTML = '<div class="alert alert-info">Creating patient...</div>';
                const response = await fetch('/api/patient', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = '<div class="alert alert-success">Patient created successfully!</div>';
                    showResults(result.bundle_id, result.resources.length);
                } else {
                    statusDiv.innerHTML = `<div class="alert alert-danger">Error: ${result.error}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });

        function showResults(bundleId, resourceCount) {
            const resultsSection = document.getElementById('results');
            const resultInfo = document.getElementById('resultInfo');
            
            resultInfo.innerHTML = `
                <div class="alert alert-success">
                    <h5>Conversion Complete!</h5>
                    <p>Generated ${resourceCount} FHIR resources</p>
                    <p>Bundle ID: ${bundleId}</p>
                </div>
            `;
            
            // Set up download buttons
            document.getElementById('downloadJson').onclick = () => {
                window.open(`/api/download/${bundleId}`, '_blank');
            };
            
            document.getElementById('downloadCsv').onclick = () => {
                window.open(`/api/export/${bundleId}/csv`, '_blank');
            };
            
            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
